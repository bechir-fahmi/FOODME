<div class="row">
  <div class="">
  </div>
  <h3 class="title-5 m-b-35">Orders List</h3>
  <div class="row">
    <div class="col-sm-2">
      <button class="btn-filter" mat-raised-button color="accent" (click)="showFiltre()">
        <mat-icon>filter_list</mat-icon> Filter
      </button>
    </div>
  </div>

  <div class="row" *ngIf="isFiltreShowed">
    <mat-card>
      <form  (ngSubmit)="save()">
        <mat-card-content>
          <div class="row">
            
            <div class="col-sm-4 col-12">

              <mat-form-field appearance="fill" class="style-filtre">
                <mat-label>Brand</mat-label>
                <mat-select [(ngModel)]="orderFilter.orderBrandFilter"  (selectionChange)="eventBrandId($event)" [ngModelOptions]="{standalone: true}" >
                  <mat-option *ngFor="let ws of brands"  [value]="ws.id">
                    {{ ws.nameLanguageResources[0].value }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-sm-4 col-12">

            <mat-form-field appearance="fill" class="style-filtre">
              <mat-label>Restaurant</mat-label>
              <mat-select [(ngModel)]="orderFilter.orderRestaurantFilter"  (selectionChange)="eventRestaurantId($event)" [ngModelOptions]="{standalone: true}" >
                <mat-option *ngFor="let ws of restaurants"  [value]="ws.id">
                  {{ ws.nameLanguageResources[0].value }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-sm-4 col-12">

            <mat-form-field appearance="fill" class="style-filtre">
              <mat-label>Region</mat-label>
              <mat-select  [(ngModel)]="orderFilter.orderRegionFilter"  (selectionChange)="eventRegionId($event)" [ngModelOptions]="{standalone: true}" >
                <mat-option *ngFor="let ws of regions"  [value]="ws.id" >
                  {{ ws.languageResources[0].value }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
   
          </div>
          <div class="row">
            <div class="col-sm-4 col-12">

              <mat-form-field appearance="fill" class="style-filtre">
                <mat-label>City</mat-label>
                <mat-select  [(ngModel)]="orderFilter.orderCityFilter"  (selectionChange)="eventCityId($event)"  [ngModelOptions]="{standalone: true}">
                  <mat-option *ngFor="let ws of cities"  [value]="ws.id" >
                    {{ ws.languageResources[0].value }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-sm-4 col-12">
              <mat-form-field appearance="fill" class="style-filtre">
                <mat-label>Order Status</mat-label>
                <mat-select  [(ngModel)]="orderFilter.orderStatusFilter"  (selectionChange)="eventOrderStatusId($event)"  [ngModelOptions]="{standalone: true}" >
                  <mat-option *ngFor="let ws of orderStatusSelect"  [value]="ws.value"   >
                    {{ ws.viewValue }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-sm-4 col-12">
              <mat-form-field appearance="fill" class="style-filtre">
                <mat-label>Order Type</mat-label>
                <mat-select  [(ngModel)]="orderFilter.deliveryTypeFilter"  (selectionChange)="eventDeliveryTypeId($event)" [ngModelOptions]="{standalone: true}" >
                  <mat-option *ngFor="let ws of orderTypeSelect"  [value]="ws.value">
                    {{ ws.viewValue }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
  
          </div>

          <div class="row">
            <div class="col-sm-4 col-12">
              <mat-form-field appearance="fill" class="style-filtre">
                <mat-label>Payment Type</mat-label>
                <mat-select   [(ngModel)]="orderFilter.paymentModeFilter"  (selectionChange)="eventPayementTypeId($event)"  [ngModelOptions]="{standalone: true}">
                  <mat-option *ngFor="let ws of paymentModeSelect"   [value]="ws.value" >
                    {{ ws.viewValue }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-sm-4 col-12">
              <mat-form-field appearance="fill" class="style-filtre">
                <mat-label>Payment Status</mat-label>
                <mat-select [(ngModel)]="orderFilter.paymentStatusFilter"  (selectionChange)="eventPayementStatusId($event)" [ngModelOptions]="{standalone: true}">
                  <mat-option *ngFor="let ws of paymentStatusSelect"   [value]="ws.value">
                    {{ ws.viewValue }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-sm-4 col-12">
              <mat-form-field class="example-full-width" class="style-filtre">
                <mat-label>Restaurant Name</mat-label>
                <input matInput type="text" [(ngModel)]="orderFilter.restaurantNameFilter" [ngModelOptions]="{standalone: true}" [ngModelOptions]="{standalone: true}" />
              </mat-form-field>
            </div>
    
            </div>
            <div class="row">
              <div class="col-sm-4 col-12">
                <mat-form-field class="example-full-width" class="style-filtre">
                  <mat-label>Mobile</mat-label>
                  <input matInput  type="tel" [(ngModel)]="orderFilter.PhoneNumberFilter" [ngModelOptions]="{standalone: true}" [ngModelOptions]="{standalone: true}" />
                </mat-form-field>
              </div>
              <div class="col-sm-4 col-12">
                <mat-form-field appearance="fill" class="style-filtre">
                  <mat-label>Enter a date range</mat-label>
                  <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
                    <input matStartDate formControlName="start" placeholder="Start date" [(ngModel)]="orderFilter.orderFromDateFilter"   />
                    <input matEndDate formControlName="end" placeholder="End date"  [(ngModel)]="orderFilter.orderToDateFilter" />
                  </mat-date-range-input>
  
                  <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-date-range-picker #picker></mat-date-range-picker>
    
                  <mat-error *ngIf="range.controls.start.hasError('matStartDateInvalid')"
                    >Invalid start date</mat-error
                  >
                  <mat-error *ngIf="range.controls.end.hasError('matEndDateInvalid')"
                    >Invalid end date
                  </mat-error>
                </mat-form-field>
    
   
              </div>
              

              <div class="col-sm-4 col-12">

                <mat-form-field appearance="fill" class="style-filtre">
                  <mat-label>Agent</mat-label>
                  <mat-select  [(ngModel)]="orderFilter.agentIdFilter" (selectionChange)="eventAgentId($event)" [ngModelOptions]="{standalone: true}" >
                    <mat-option *ngFor="let ws of users" [value]="ws.id" >
                     {{ws.fullName}} 
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

      
            </div>
            <div class="row">
              <div class="col-sm-4 col-12">

                <mat-form-field appearance="fill" class="style-filtre">
                  <mat-label>Company</mat-label>
                  <mat-select  [(ngModel)]="orderFilter.orderCompanyFilter" (selectionChange)="companyIdFilter($event)" [ngModelOptions]="{standalone: true}">
                    <mat-option *ngFor="let ws of devliveryCompanies"   [value]="ws.id"  >
                      {{ ws.languageResources[0].value }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div class="col-sm-4 col-12">
                <mat-form-field class="example-full-width" class="style-filtre">
                  <mat-label>Order Id</mat-label>
                  <input matInput  type="number" [(ngModel)]="orderFilter.orderIdFilter" [ngModelOptions]="{standalone: true}"  />
                </mat-form-field>
              </div>

              

            </div>

            <div class="row">
              <div class="col-sm-4 col-12">
                <mat-checkbox class="example-margin style-filtre"  [(ngModel)]="orderFilter.withoutSDMIdthen30second" [ngModelOptions]="{standalone: true}">Without SDM ID</mat-checkbox>
              </div>
              <div class="col-sm-4 col-12">
                <mat-checkbox class="example-margin style-filtre" [(ngModel)]="orderFilter.payLaterFilter" [ngModelOptions]="{standalone: true}">Pay later</mat-checkbox>
              </div>
              <div class="col-sm-4 col-12">
                <mat-checkbox class="example-margin style-filtre" [(ngModel)]="orderFilter.withTotalServicesTime40FilterActive" [ngModelOptions]="{standalone: true}" >With total services time > 40min</mat-checkbox>
              </div>
            </div>
              <div class="row">
              <div class="col-sm-4 col-12">
                <mat-checkbox class="example-margin style-filtre " [(ngModel)]="orderFilter.withTotalServicesTime60FilterActive" [ngModelOptions]="{standalone: true}">With total services time > 60min</mat-checkbox>
              </div>
              <div class="col-sm-4 col-12">
                <mat-checkbox class="example-margin style-filtre" [(ngModel)]="orderFilter.findingDriverthen2min" [ngModelOptions]="{standalone: true}" >Finding Driver > 2min</mat-checkbox>
              </div>
              <div class="col-sm-4 col-12">
                <mat-checkbox class="example-margin style-filtre"  [(ngModel)]="orderFilter.preparingthen20min" [ngModelOptions]="{standalone: true}" >Preparing > 20min</mat-checkbox>
              </div>
            </div>
          
    
          
        </mat-card-content>
        <mat-card-actions>
          <button class="btn-action button-filtre" type="submit">Search</button>
        </mat-card-actions>
      </form>

    </mat-card>
  </div>



  <br><br><br>
  <div class="col-md-12 wraper">
    <!-- DATA TABLE -->

    <div class="divtable">
      <table class="table table-data2">
        <thead>
          <tr>
            <th>
              <label class="au-checkbox">
                <input type="checkbox" />
                <span class="au-checkmark"></span>
              </label>
            </th>
            <th>ID</th>
            <th>Time</th>
            <th>Restaurant</th>
            <th>Customer</th>
            <th>Order Mode</th>
            <th>payment</th>
            <th>Order status</th>
            <th>Company</th>
            <th>External operator</th>
            <th>Total</th>
            <th class="headcolth">Action</th>
          </tr>
        </thead>
        <tbody >
          <tr class="tr-shadow"   *ngFor="let order of orders" [ngClass]="changeColorLigneTable(order) ? setClasses :''">
            <td>
              <label class="au-checkbox">
                <input type="checkbox" />
                <span class="au-checkmark"></span>
              </label>
            </td>
            <td>
              <h6>{{order.id }}</h6>
            </td>
            <td>{{order.creationTime}}</td>
            <td>{{ getLabel(order.restaurantId|restaurantName| async)}}</td>

            <td class="desc">
             <span *ngIf="order.externalOperatorKey"> WeCare-5652661222</span>  <br />
             <span (click)="openPopupCart(order)"> cart</span> <br />invoice
            </td>
            <td>Pickup</td>
            <td>
              {{   getViewValuePaymentMode( order.paymentMode) }}<br />
              <h6> {{getViewValuePaymentStatus(order.paymentStatus)}}</h6>
            </td>

            <td>
              <span class="status--process"
                >{{getViewValueOrderStatus(order.orderStatus)}} <br />
               {{order.orderStatusDate | date: 'yyyy-MM-dd'}}<br />
               {{order.orderStatusDate | date : 'h:mm a'}}</span
              >
            </td>
            <td> {{getdevliveryCompanies(order.deliveryCompanyKey)}} </td>
            <td>{{order.orderExternalOperatorId}}</td>
            <td>{{order.total}} </td>
            <td class="headcol">
              <div class="table-data-feature">
                <button mat-raised-button color="primary" (click)="openPopupTrack(order)">Track</button>
                <button mat-raised-button *ngIf="!order.externalOperatorKey" >Add Coupon</button>
                <button mat-raised-button  >Resend</button>
                <button mat-raised-button *ngIf="isVisibleForcedClosedButton(order)" >Force closed</button>
                <button mat-raised-button *ngIf="isVisibleForcedCancelButton(order)" color="warn">Force Cancel</button>
    
              </div>
            </td>
          </tr>
          <tr class="spacer"></tr>
          <tr class="tr-shadow">
            <td>
              <label class="au-checkbox">
                <input type="checkbox" />
                <span class="au-checkmark"></span>
              </label>
            </td>
            <td>
              <h6>2</h6>
            </td>
            <td>2018-09-27 02:12</td>
            <td>Jeddah - Manar Plaza</td>

            <td class="desc">
              WeCare-5652661222 <br />
              cart <br />invoice
            </td>
            <td>Pickup</td>
            <td>
              Cash<br />
              <h6>NotPaid</h6>
            </td>

            <td>
              <span class="status--denied"
                >ForceCancel <br />
                2023-03-30 <br />
                8:41AM</span
              >
            </td>
            <td>taker - Brisk</td>
            <td>HungerStation</td>
            <td>33</td>
            <td class="headcol">
              <div class="table-data-feature">
                <button class="item item-ordcancel" data-toggle="tooltip" data-placement="top" title="Send">
                  <i class="zmdi zmdi-mail-send"></i>
                </button>
                <button class="item item-ordcancel" data-toggle="tooltip" data-placement="top" title="Edit">
                  <i class="zmdi zmdi-edit"></i>
                </button>
                <button class="item item-ordcancel" data-toggle="tooltip" data-placement="top" title="Delete">
                  <i class="zmdi zmdi-delete"></i>
                </button>
                <button class="item item-ordcancel" data-toggle="tooltip" data-placement="top" title="More">
                  <i class="zmdi zmdi-more"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- END DATA TABLE -->
  </div>
</div>
